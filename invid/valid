

  validation {
    condition = alltrue([
      for config in var.access_config : 
      (
        config.authentication_mode == "CONFIG_MAP" || 
        config.authentication_mode == "API" || 
        config.authentication_mode == "API_AND_CONFIG_MAP"
      ) &&
      (config.bootstrap_cluster_admin_permission == true || config.bootstrap_cluster_admin_permission == false)
    ])
    error_message = "authentication_mode must be 'CONFIG_MAP', 'API', or 'API_AND_CONFIG_MAP', and bootstrap_cluster_admin_permission must be true or false."
  }

#version 
variable "cluster_version" {
  description = "Kubernetes <major>.<minor> version to use for the EKS cluster (i.e.: 1.27)"
  type        = string
  default     = null

  validation {
    condition     = can(regex("^\\d+\\.\\d+$", var.cluster_version)) && (var.cluster_version != "")
    error_message = "Cluster version must be in the format <major>.<minor> (e.g., '1.27')."
  }
}

#timeout 
validation {
    condition = alltrue([
      for key, value in var.timeout : 
        (key == "create" || key == "update" || key == "delete") &&
        can(regex("^\\d+[smhdwMy]?$", value))
    ])
    error_message = "Each timeout value must be in a valid duration format (e.g., '30m', '1h', '2d') for create, update, and delete keys."
  }


##vpc config 
variable "vpc_config" {
  description = "Configuration for VPC, including endpoint settings and subnet set"
  type = object({
    endpoint_private = bool
    endpoint_public  = bool
    subnet_set       = set(string)
  })
  default = {
    endpoint_private = true
    endpoint_public  = false
    subnet_set       = []
  }

  validation {
    # Ensure the endpoint_private and endpoint_public are booleans
    condition = (
      (var.vpc_config.endpoint_private == true || var.vpc_config.endpoint_private == false) &&
      (var.vpc_config.endpoint_public == true || var.vpc_config.endpoint_public == false) &&
      can(list(var.vpc_config.subnet_set)) &&
      alltrue([for subnet in var.vpc_config.subnet_set : can(regex("^subnet-[0-9a-f]+$", subnet))])
    )
    error_message = "endpoint_private and endpoint_public must be boolean values, and subnet_set must contain valid subnet IDs (e.g., 'subnet-12345678')."
  }
}

